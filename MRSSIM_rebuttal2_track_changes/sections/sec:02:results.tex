\section{Results}\label{sec:Results}
\subsection{Standard Spectral Components}\label{results: standard components}
% \input{figures/fig:sba:lorentzian}
% \input{figures/fig:sba:gaussian}
% \input{figures/fig:sba:voigt}
% \input{figures/fig:sba:fshift}
% \input{figures/fig:sba:phi0}
% \input{figures/fig:sba:phi1}
% \input{figures/fig:sba:snr}
% \input{figures/fig:sba:ecc}

% The following collection of figures show the effects of several standard spectral model components when their parameters are varied. These examples use the same spectrum which was simulated using the following basis functions with fixed concentrations for all simulations: Asc, Asp, Ch, Cr, GABA, GPC, GSH, Gln, Glu, mI, Lac, NAA, NAAG, PCh, PCr, PE, sI, Tau, MM09, MM12, MM14, MM17, MM20, Lip09, Lip13, and Lip20. Standard T2 values were assigned to each based on values present by Wyss et al.\cite{Wyss2018}. When spectral components are not being studied, their values are fixed. Baselines were omitted to better highlight the impact of the individual components.

The following collection of figures show the effects of several standard spectral model components when their parameters are varied. When spectral components are not being studied, their values are fixed. Fig. \ref{fig:30ms samples lorentzians} shows the effect of lorentzian line broadening in the absence of any gaussian broadening. In the top row, the height of the y-axis drops from left-to-right showing the decrease in signal intensity. On the bottom row the differences are not as severe, so a single y-axis is used. Here it is more clearly shown that the spectral peaks are both losing intensity %\FloatBarrier 
% \noindent 
and widening. Fig. \ref{fig:30ms samples gaussians} uses the same display protocol to show the effects of gaussian broadening without lorentzian broadening whereas Fig. \ref{fig:30ms samples voigt} shows several combinations of lorentzian and gaussian broadening that, when combined, give the Voigt lineshape. Fig. \ref{fig:30ms samples voigt} breaks down the effects of the lorentzian and gaussian broadening on the Voigt lineshape in the top and bottom rows. On top, the gaussian value is fixed to 20Hz while scaling the $T_2^*$ values using the scaling factors indicated in the captions. On the bottom, the lorentzian broadening is fixed and the gaussian values vary.

\input{figures/fig:sba:lorentzian}
\input{figures/fig:sba:gaussian}
\input{figures/fig:sba:voigt}
\input{figures/fig:sba:fshift}
\input{figures/fig:sba:phi0}
\input{figures/fig:sba:phi1}
\input{figures/fig:sba:snr}
\input{figures/fig:sba:ecc}


Fig. \ref{fig:30ms samples fshift} shows two applications of frequency shifts, with all other parameters held constant. The top row shows how global frequency shifts translate spectra upfield and downfield. The bottom row shows the effects of giving each metabolite basis function a minor, randomly sampled frequency shift, which corresponds to fitting protocols. In this case, it is more appropriate to use informed frequency shift values for each metabolite rather than randomly sampling, like the global shifts, because this can increase undesirable spectral overlap. 

Next, Fig. \ref{fig:30ms samples phi0} and \ref{fig:30ms samples phi1} show the effects of zero- and first-order phase offsets, respectively. The amount of phase added to each sample is specified in the caption underneath each plot. Then, Fig. \ref{fig:30ms samples snr} shows identical spectra with varying levels of spectral SNR. Most simulations should include noise, but this becomes especially important when simulating multi-coil transients and multiple acquisitions or editing sequences. The final standard spectral artifact is presented in Fig. \ref{fig:30ms samples ecc}, eddy currents. As described in Sec. \ref{sec: methods: sub: PM: sub EC}, this model uses two variables: an amplitude and a time constant. The top row of Fig. \ref{fig:30ms samples ecc} shows the effects of increasing the amplitude given a fixed time constant. The bottom then shows the effects of varying time constants given a fixed amplitude.

% % \FloatBarrier
% \input{figures/fig:sba:coils}

Instead of a spectral artifact, Fig. \ref{fig:30ms samples coils} shows one of the unique features of MRS-Sim: the ability to simulate groups of transients. These examples represent spectra acquired with an 8-channel receiver coil. The coil-combined spectra are shown in blue at the bottom. From left to right the spectral SNR of the coil-combined spectrum increases from 7.5 to 15. The first example was simulated with standard artifacts, but no phase or frequency drift. Global phase offsets are still visible, but the spectral SNR shows significant improvement when the transients are averaged. In the examples in the middle and the right, randomly sampled zero-order phase and frequency drifts were applied. The impact of these effects can be seen in their respective] coil-combined spectra which show improved noise profiles but diminished spectral intensity.

\input{figures/fig:sba:coils}
\FloatBarrier


\subsection{$B_0$ Field Inhomogeneity Simulator}\label{results:B0}
% \input{figures/fig:sba:coils}
\input{figures/fig:30ms_B0_samples}
Fig. \ref{fig:30ms B0 samples} shows a short echo (TE=30ms) spectrum that is corrupted by varying levels of $B_0$ inhomogeneities. %As mentioned above, MRS-Sim assumes a linear gradient in all three dimensions. 
The first example is the reference and has Lorentzian lineshapes with a mean $B_0$ offset of 1 Hz. The center plot in the top row shows that even a 20 Hz mean offset has a large impact on the spectral intensity. The $B_0$ inhomogeneity increases from left-to-right and top-to-bottom from 1 Hz to 270 Hz with an interval size of 19 Hz. The total change in each dimension is between 2-10 Hz centered about the mean offset. The red spectra represent the real component from the previous example to highlight the effects of the increasing inhomogeneities. This figure shows that even moderate inhomogeneities noticeably impact the spectral resolution, signal intensity and frequency offset.


\subsection{Baseline and Residual Water Generator}\label{results:baseline}
\input{figures/fig:30ms_samples_clean}
Fig. \ref{fig:30ms samples curated clean} illustrates a single clean short echo (TE=30ms) PRESS spectrum showcasing various combinations of residual water and baseline contributions. The metabolite concentrations and lineshapes were fixed in addition to the settings described above. These samples omit spectral artifacts to more clearly highlight the variety that can be achieved by randomly sampling parameters for the baseline and residual water generator. 

% Currently, it is unknown what a true baseline actually looks like. Theory and protocols regarding baseline modeling have been developed extensively, but the physical phenomena underlying the baseline signal is still poorly understood. Therefore, different modeling protocols can produce different baselines. Bazgir et al.\cite{Bazgir2018} interpolate between selected minima in the spectra, Wilson et al.\cite{Wilson2021} uses penalized B-splines to overparametize the problem space which is solved using an optimized smoothing constraint, while Osprey\cite{Oeltzschner2020} uses unregularized B-splines spread every 0.4 ppm to enforce smoothness. Even though all of these techniques have been proved useful, in vivo data does not have known ground truths meaning there is no way to identify which method is the most accurate. Without a physics-based model, other methods of baseline simulation are necessary. 

Fig. \ref{fig:30ms samples curated clean} shows a variety of baseline profiles that can be simulated with the presented framework. Instead of claiming to produce in vivo baselines, the proposed generator produces a wide variety of baseline offsets that approximate the baselines extracted by traditional methods. The motivation behind this approach is that if the generator cannot be limited to strictly in vivo-like baselines, then it should incorporate a variety of appropriate baseline profiles such that true baselines are included. Because this generator is not based on a baseline fitting method, future work could use it to evaluate the baseline modeling performance of various fitting protocols given different baseline profiles.



\subsection{Complete Model}\label{results:complete model}
\input{figures/fig:30ms_samples_artifacts}
In contrast, Fig. \ref{fig:30ms samples curated dirty} presents a simulated PRESS spectrum (TE=30ms) with randomly sampled artifacts and offsets. This figure highlights the variety a single spectrum can assume just by randomly sampling the artifacts. Sophisticated simulations, such as these, are useful for developing and validating data processing techniques such as artifact removal and new spectral fitting protocols. Spectra can be simulated to be as clean or as artifact-laden as desired, all while maintaining known ground truth values. 

Upon closer inspection of Fig. \ref{fig:30ms samples curated dirty}, the baselines and residual water regions sometimes appear to be uncorrelated with the depicted spectra, but they are in fact paired. These discrepancies are due to the additional artifacts that are applied to the simulations after all of the spectral components are combined. The plotted baseline and residual water regions are the ground truth signals and do not have those additional artifacts applied to them. 

Incorporating a robust collection of artifacts and phenomena commonly encountered with in vivo data into these simulations, makes resulting datasets more closely approximate raw, in vivo data. Even though post-processing techniques are highly accurate, they have limitations and biases, leaving some residue of the corrected artifacts. Including these artifacts in the simulations and removing them with the users' own post-processing and fitting protocols ensures consistency between simulated and in vivo data. These artifacts can also be scaled down in the simulations to emulate residual artifacts. However, this is not ideal because it cannot be guaranteed that scaling down the artifacts will accurately reflect the biases and residues found in the in vivo data.

Deep learning techniques also benefit from robust and consistent synthetic data. Ensuring congruence of the synthetic training data with the in vivo data promotes better model performance. While including fine-grained detail, such as sampling moiety-level $T_2$ values, may not be essential for every use case, in a deep learning setting, it acts as a form of data augmentation. Such augmentation techniques maintain the underlying data but manipulate its appearance so that models learn a broader range of features instead of overfitting a single pattern. These techniques are standard practice in deep learning and are an inherent feature of this framework. 


